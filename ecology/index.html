<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Ecology · Business Constellation · StarTimes Uganda</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <style>
    /* 1. 全局重置与基础设定 */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-dark: #050816;
      --glass-bg: rgba(15, 23, 42, 0.85);
      --glass-border: rgba(148, 163, 184, 0.2);
      --text-main: #e5e7eb;
      --text-muted: #94a3b8;
      --accent-blue: #38bdf8;
      --top-bar-height: 56px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-main);
      /* 核心布局：Flex 纵向排列，强制占满视口高度 */
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden; /* 桌面端禁止滚动，保持沉浸感 */
    }

    /* 2. 顶部导航栏 - 固定高度，不参与压缩 */
    .top-bar {
      flex: 0 0 var(--top-bar-height);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 50;
      background: rgba(5, 8, 22, 0.8);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--glass-border);
    }

    .brand { display: flex; flex-direction: column; gap: 2px; }
    .brand-path { font-size: 10px; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-muted); }
    .brand-title { font-size: 16px; font-weight: 700; letter-spacing: 0.5px; }

    .top-actions { display: flex; align-items: center; gap: 12px; }
    .chip {
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border);
      color: var(--text-muted);
      display: none; /* 移动端隐藏，桌面端显示 */
    }
    @media (min-width: 768px) { .chip { display: block; } }

    .back-btn {
      padding: 6px 16px;
      border-radius: 999px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      font-size: 12px;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      transition: transform 0.2s;
    }
    .back-btn:hover { transform: translateY(-1px); }

    /* 3. 主舞台 - 自动填充剩余空间 */
    .main-stage {
      flex: 1; /* 占据除去顶部栏之外的所有空间 */
      position: relative;
      width: 100%;
      height: 100%; /* 确保子元素能继承高度 */
      background:
        radial-gradient(circle at 15% 15%, rgba(56, 189, 248, 0.15), transparent 40%),
        radial-gradient(circle at 85% 85%, rgba(234, 179, 8, 0.1), transparent 40%),
        #020617;
      overflow: hidden;
    }

    /* 4. 图表容器 - 绝对定位撑满主舞台 */
    #eco-orbit {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100%;
      height: 100%;
      z-index: 1; /* 图表在最底层 */
    }

    /* 5. 悬浮面板系统 */
    .panels-layer {
      position: absolute;
      inset: 0;
      pointer-events: none; /* 让鼠标事件穿透面板层，直达图表 */
      z-index: 10;
      padding: 20px;
    }

    .panel {
      pointer-events: auto; /* 恢复面板本身的交互 */
      position: absolute;
      width: 260px;
      padding: 16px;
      border-radius: 16px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: opacity 0.3s, transform 0.3s;
    }

    .panel h2 { font-size: 14px; color: var(--text-main); margin-bottom: 6px; }
    .panel small { display: block; font-size: 10px; color: var(--accent-blue); letter-spacing: 1px; margin-bottom: 4px; font-weight: 700; }
    .panel p { font-size: 12px; color: var(--text-muted); line-height: 1.6; }

    /* 面板位置定位 */
    .panel-overview { top: 20px; left: 20px; }
    .panel-kpi { top: 20px; right: 20px; text-align: right; }
    .panel-legacy { bottom: 20px; left: 20px; }
    .panel-growth { bottom: 20px; right: 20px; text-align: right; }

    /* 6. 标签胶囊样式 */
    .tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
    .tag {
      font-size: 10px; padding: 2px 8px; border-radius: 4px;
      background: rgba(255,255,255,0.08); color: #cbd5e1;
    }

    /* 7. 移动端适配：变为垂直滚动流 */
    @media (max-width: 768px) {
      body { height: auto; overflow-y: auto; } /* 允许滚动 */
      .top-bar { position: sticky; top: 0; }
      
      .main-stage {
        display: flex;
        flex-direction: column;
        height: auto;
        min-height: 100vh; /* 保证至少一屏 */
      }

      #eco-orbit {
        position: relative; /* 恢复文档流 */
        height: 85vh; /* 移动端图表高度 */
        min-height: 500px;
      }

      .panels-layer {
        position: relative;
        padding: 0 16px 32px 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .panel {
        position: relative; /* 取消绝对定位 */
        top: auto !important; left: auto !important; right: auto !important; bottom: auto !important;
        width: 100%; /* 满宽 */
        text-align: left !important;
      }
    }
  </style>
</head>
<body>

  <!-- 顶部导航 -->
  <nav class="top-bar">
    <div class="brand">
      <span class="brand-path">STARTIMES · UGANDA</span>
      <span class="brand-title">Business Constellation</span>
    </div>
    <div class="top-actions">
      <span class="chip">Data Space v2.1</span>
      <a href="../index.html" class="back-btn">Exit</a>
    </div>
  </nav>

  <!-- 主舞台 -->
  <main class="main-stage">
    
    <!-- 1. ECharts 容器 -->
    <div id="eco-orbit"></div>

    <!-- 2. 悬浮面板层 -->
    <div class="panels-layer">
      
      <!-- 左上：总览 -->
      <article class="panel panel-overview">
        <small>SYSTEM OVERVIEW</small>
        <h2>五大业务星系</h2>
        <p>将核心业务线映射为行星轨道。点的大小代表 KPI 权重，颜色映射业绩趋势。</p>
        <div class="tags">
          <span class="tag">Solar</span>
          <span class="tag">DTV/DTH/DTT</span>
          <span class="tag">OTT</span>
        </div>
      </article>

      <!-- 右上：指南 -->
      <article class="panel panel-kpi">
        <small>VISUAL GUIDE</small>
        <h2>如何阅读星图</h2>
        <p>
          <span style="color:#4ade80">● 绿色</span> 增长/达标<br>
          <span style="color:#f87171">● 红色</span> 下滑/未达标<br>
          <span style="color:#94a3b8">● 灰色</span> 波动持平<br>
          *点越大，业务数值体量越大
        </p>
      </article>

      <!-- 左下：传统业务 -->
      <article class="panel panel-legacy">
        <small>LEGACY CLUSTER</small>
        <h2>DVB 传统电视业务</h2>
        <p>包含 DTV、DTH 和 DTT。目前数据点呈现密集但偏暖色（红色），反映出存量市场的用户与营收下行压力。</p>
      </article>

      <!-- 右下：新增长点 -->
      <article class="panel panel-growth">
        <small>GROWTH ENGINE</small>
        <h2>Solar & OTT 新引擎</h2>
        <p>外层轨道。Solar 的分期回款与 OTT 的活跃度呈现较多绿色高亮，是当前生态中活力最强的增长极。</p>
      </article>

    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script>
    // 初始化图表
    var dom = document.getElementById('eco-orbit');
    var chart = echarts.init(dom, null, { renderer: 'canvas' });

    // 配置参数
    var businessDefs = [
      { id: 'Solar', label: 'Solar', angle: -120, radius: 0.30, tone: 'green' },
      { id: 'DTV',   label: 'DTV',   angle: -45,  radius: 0.44, tone: 'blue'  },
      { id: 'DTH',   label: 'DTH',   angle: 45,   radius: 0.58, tone: 'cyan'  },
      { id: 'DTT',   label: 'DTT',   angle: 120,  radius: 0.72, tone: 'indigo'},
      { id: 'OTT',   label: 'OTT',   angle: 200,  radius: 0.86, tone: 'violet'}
    ];

    // 颜色生成器
    function toneColor(tone, alpha) {
      var map = {
        'green':  '34, 197, 94',
        'blue':   '59, 130, 246',
        'cyan':   '45, 212, 191',
        'indigo': '99, 102, 241',
        'violet': '217, 70, 239'
      };
      var rgb = map[tone] || '148, 163, 184';
      return 'rgba(' + rgb + ', ' + alpha + ')';
    }

    // 数据集
    var kpiRaw = {
      Solar: [
        { name: '销量', value: 1481, trend: 'down' },
        { name: '应收收入', value: 168973, trend: 'down' },
        { name: '累计应收', value: 23072112, trend: 'up' }, // 大泡泡
        { name: '回款进度', value: 80729, trend: 'down' }
      ],
      DTV: [
        { name: '新增用户', value: 110, trend: 'down' },
        { name: '活跃用户', value: 39510, trend: 'down' },
        { name: 'ARPPU', value: 3.28, trend: 'down' }
      ],
      DTH: [
        { name: '活跃用户', value: 349860, trend: 'down' }, // 中泡泡
        { name: '充值金额', value: 289402, trend: 'down' },
        { name: '新增用户', value: 425, trend: 'down' }
      ],
      DTT: [
        { name: '活跃用户', value: 344459, trend: 'down' },
        { name: '充值金额', value: 263016, trend: 'down' },
        { name: 'ARPPU', value: 2.33, trend: 'down' }
      ],
      OTT: [
        { name: 'MAU', value: 371110, trend: 'up' },
        { name: 'DAU', value: 46168, trend: 'up' },
        { name: '会员收入', value: 2365, trend: 'up' },
        { name: '广告收入', value: 10, trend: 'up' }
      ]
    };

    // 生成数据点
    var clusterPoints = [];
    var planetCores = [];

    businessDefs.forEach(function(biz) {
      var metrics = kpiRaw[biz.id] || [];
      
      // 1. 添加行星核心
      planetCores.push({
        name: biz.label,
        value: [biz.angle, biz.radius], // 极坐标：角度，半径
        itemStyle: {
          color: toneColor(biz.tone, 1),
          shadowBlur: 20,
          shadowColor: toneColor(biz.tone, 0.8)
        },
        label: { show: true, formatter: '{b}', offset: [0, 20], color: '#fff' }
      });

      if(metrics.length === 0) return;
      var maxVal = Math.max.apply(null, metrics.map(function(o){return o.value}));

      // 2. 生成卫星云点
      metrics.forEach(function(m) {
        var count = 3 + Math.floor(Math.random() * 5); // 每个指标分裂成 3-8 个点
        var ratio = Math.sqrt(m.value / maxVal); // 归一化大小
        
        for(var i=0; i<count; i++) {
          // 随机扰动位置
          var jitterAngle = (Math.random() - 0.5) * 20; 
          var jitterRadius = (Math.random() - 0.5) * 0.12;
          
          // 确定颜色
          var color = '#94a3b8'; // default grey
          if(m.trend === 'up') color = '#4ade80'; // bright green
          if(m.trend === 'down') color = '#f87171'; // soft red

          var alpha = 0.3 + Math.random() * 0.5;

          clusterPoints.push({
            name: m.name,
            valRaw: m.value,
            trend: m.trend,
            // 极坐标数据结构: [角度, 半径, 大小]
            value: [
              biz.angle + jitterAngle, 
              biz.radius + jitterRadius, 
              (3 + ratio * 8) * (0.8 + Math.random()) // 大小随机化
            ],
            itemStyle: {
              color: color,
              opacity: alpha
            }
          });
        }
      });
    });

    // ECharts 配置
    var option = {
      backgroundColor: 'transparent',
      // 极坐标系配置
      polar: {
        radius: ['10%', '85%']
      },
      angleAxis: {
        type: 'value',
        startAngle: 90,
        min: -180,
        max: 180,
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { show: false }
      },
      radiusAxis: {
        type: 'value',
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { 
          show: true,
          lineStyle: {
            color: 'rgba(255,255,255,0.05)',
            type: 'dashed'
          }
        }
      },
      tooltip: {
        show: true,
        backgroundColor: 'rgba(15, 23, 42, 0.9)',
        borderColor: '#334155',
        textStyle: { color: '#f1f5f9' },
        formatter: function(params) {
          if(params.seriesName === 'Planets') return params.name;
          var d = params.data;
          var trendIcon = d.trend === 'up' ? '▲' : (d.trend === 'down' ? '▼' : '-');
          return `
            <div style="font-weight:bold; color:#cbd5e1">${d.name}</div>
            <div style="font-size:12px; color:#94a3b8">Value: ${d.valRaw.toLocaleString()}</div>
            <div style="font-size:12px; margin-top:4px">Trend: ${trendIcon}</div>
          `;
        }
      },
      series: [
        // 1. 核心行星
        {
          name: 'Planets',
          type: 'scatter',
          coordinateSystem: 'polar',
          symbolSize: 24,
          data: planetCores,
          z: 10
        },
        // 2. 数据星云
        {
          name: 'KPI Clusters',
          type: 'scatter',
          coordinateSystem: 'polar',
          data: clusterPoints,
          symbolSize: function(val) { return val[2]; }, // 使用数据中的第三位作为大小
          itemStyle: {
            shadowBlur: 5
          },
          z: 5
        }
      ],
      animationDuration: 2000,
      animationEasing: 'cubicOut'
    };

    chart.setOption(option);

    // 监听窗口大小变化
    window.addEventListener('resize', function() {
      chart.resize();
    });
  </script>
</body>
</html>
