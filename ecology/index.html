<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Ecology · Business Constellation · StarTimes Uganda</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont,"SF Pro Text",
        "Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans SC",sans-serif;
      background: #050816;
      color: #e5e7eb;
      overflow: hidden;
    }

    .top-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 26px;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: linear-gradient(
        to bottom,
        rgba(5,7,24,0.96),
        rgba(5,7,24,0.75),
        transparent
      );
      border-bottom: 1px solid rgba(148,163,184,0.35);
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .brand-path {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #6b7280;
    }

    .brand-title {
      font-size: 16px;
      font-weight: 600;
    }

    .top-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.8);
      color: #9ca3af;
    }

    .back {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: radial-gradient(circle at top left,rgba(96,165,250,0.9),rgba(15,23,42,0.98));
      color: #e5e7eb;
      text-decoration: none;
    }

    .scene {
      position: absolute;
      top: 52px; bottom: 0; left: 0; right: 0;
      overflow: hidden;
      background:
        radial-gradient(circle at 15% 10%, rgba(56,189,248,0.22), transparent 55%),
        radial-gradient(circle at 85% 90%, rgba(234,179,8,0.25), transparent 60%),
        radial-gradient(circle at 70% 15%, rgba(236,72,153,0.18), transparent 55%),
        #020617;
    }

    #eco-orbit {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .panel {
      position: absolute;
      border-radius: 20px;
      padding: 14px 16px;
      border: 1px solid rgba(148,163,184,0.55);
      background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,0.9));
      box-shadow:
        0 18px 55px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.9) inset;
      backdrop-filter: blur(18px);
      max-width: 260px;
      font-size: 12px;
      line-height: 1.6;
      color: #9ca3af;
      z-index: 5;
    }

    .panel h2 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .panel small {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #64748b;
    }

    .panel-main { left: 32px; top: 80px; max-width: 280px; }
    .panel-legacy { bottom: 36px; left: 32px; max-width: 260px; }
    .panel-new { bottom: 36px; right: 32px; max-width: 260px; }
    .panel-kpi { top: 80px; right: 32px; max-width: 260px; }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .pill {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.55);
      font-size: 11px;
      color: #cbd5f5;
    }

    @media (max-width: 900px) {
      .panel-main {
        left: 16px;
        top: 70px;
        right: 16px;
        max-width: none;
      }
      .panel-legacy,
      .panel-new,
      .panel-kpi {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="brand">
      <div class="brand-path">STARTIMES UGANDA · DATA SPACE</div>
      <div class="brand-title">Ecology · 业务星团图 Business Constellation</div>
    </div>
    <div class="top-actions">
      <div class="chip">中心 63·30·7 收入恒星光带 · 外圈 KPI 星团</div>
      <a class="back" href="../index.html">Back to Universe</a>
    </div>
  </div>

  <div class="scene">
    <div id="eco-orbit"></div>

    <aside class="panel panel-main">
      <small>OVERVIEW</small>
      <h2>收入结构 + 五条业务线的 KPI 星团</h2>
      <p>
        中心恒星光带展示三条主收入轨道：
        <strong>Subscription 63%</strong>、
        <strong>Solar 30%</strong>、
        <strong>Ads &amp; Devices 7%</strong>。
        外圈的星团把这三大块拆开成具体业务线
        （Solar、DTV、DTH、DTT、OTT）的 KPI。
      </p>
      <p style="margin-top:6px;">
        点靠近某个光带扇区，代表属于该收入块；点的颜色代表业务线；
        大小代表该指标在本业务内部的大致体量。
      </p>
      <div class="pill-row">
        <span class="pill">青蓝光带 · Subscription · 63%</span>
        <span class="pill">青绿光带 · Solar · 30%</span>
        <span class="pill">洋红金光带 · Ads &amp; Devices · 7%</span>
      </div>
    </aside>

    <aside class="panel panel-legacy">
      <small>LEGACY DVB CLUSTER</small>
      <h2>DTV · DTH · DTT 电视业务星团</h2>
      <p>
        传统付费电视业务的充值、扣费、ARPPU 等指标被归入
        <strong>Subscription</strong> 光带；其中带“销量 / 终端 / 设备”
        的指标则归入 <strong>Ads &amp; Devices</strong> 光带。
        点云的密度与体量对应收视费与终端收入在整个生态中的相对贡献。
      </p>
    </aside>

    <aside class="panel panel-new">
      <small>SOLAR &amp; OTT CLUSTER</small>
      <h2>Solar 与 OTT 的新增长空间</h2>
      <p>
        Solar 星团聚集于青绿光带，代表 30% 的离网增量收入；
        OTT 星团主要落在 Subscription 光带，但广告相关 KPI
        归入 Ads &amp; Devices。橙色上升点与蓝色下降点的分布，
        暗示了未来可以重点挖掘或修复的增长星域。
      </p>
    </aside>

    <aside class="panel panel-kpi">
      <small>HOW TO READ</small>
      <h2>点的含义</h2>
      <p>
        位置：中心恒星光带外，对应所属收入扇区；<br/>
        颜色：区分业务线 Solar / DTV / DTH / DTT / OTT；<br/>
        大小：在本业务内的相对指标体量；<br/>
        颜色倾向：<span style="color:#f97316;">橙色 = 上升</span>，
        <span style="color:#60a5fa;">蓝色 = 下降</span>；<br/>
        悬停：查看业务线 + 指标名称 + 当前值。
      </p>
    </aside>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script>
    var dom = document.getElementById('eco-orbit');
    var chart = echarts.init(dom);

    // === 宏观 63 / 30 / 7 三条收入光带 ===
    var macroDefs = [
      { id: 'Subscription', label: 'Subscription 63%', value: 63, color: '#22d3ee' }, // 青蓝
      { id: 'Solar',        label: 'Solar 30%',        value: 30, color: '#4ade80' }, // 青绿
      { id: 'AdsDevices',   label: 'Ads & Devices 7%', value: 7,  color: '#fb7185' }  // 洋红偏金
    ];
    var totalMacro = macroDefs.reduce(function (s, m) { return s + m.value; }, 0);

    // 业务线配色（仅在不上升 / 不下降时使用作基底）
    var businessDefs = [
      { id: 'Solar', label: 'Solar', tone: 'green' },
      { id: 'DTV',  label: 'DTV',  tone: 'blue'  },
      { id: 'DTH',  label: 'DTH',  tone: 'cyan'  },
      { id: 'DTT',  label: 'DTT',  tone: 'indigo'},
      { id: 'OTT',  label: 'OTT',  tone: 'violet'}
    ];

    function toneColor(tone, alpha) {
      switch (tone) {
        case 'green':  return 'rgba(74,222,128,'  + alpha + ')';
        case 'blue':   return 'rgba(59,130,246,' + alpha + ')';
        case 'cyan':   return 'rgba(45,212,191,' + alpha + ')';
        case 'indigo': return 'rgba(129,140,248,'+ alpha + ')';
        case 'violet': return 'rgba(236,72,153,' + alpha + ')';
        default:       return 'rgba(148,163,184,'+ alpha + ')';
      }
    }

    // KPI 原始数据
    var kpiRaw = {
      Solar: [
        { name: '销量 每月累计',          value: 1481,    trend: 'down' },
        { name: '销售收入(应收) 每月累计', value: 168973,  trend: 'down' },
        { name: '全款收款 每月累计',      value: 1148,    trend: 'down' },
        { name: '首付款收款 每月累计',    value: 10171,   trend: 'down' },
        { name: '分期款收款 每月累计',    value: 80729,   trend: 'down' },
        { name: '累计应收分期款',         value: 23072112,trend: 'up'   },
        { name: '当月应收分期款',         value: 224472,  trend: 'down' },
        { name: '分期中用户数',           value: 234390,  trend: 'up'   }
      ],
      DTV: [
        { name: '新增用户数 每月累计',    value: 110,   trend: 'down' },
        { name: '在线用户数 每月去重',    value: 8112, trend: 'down' },
        { name: '注册用户数 月末最后一天',value: 39510,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 4353, trend: 'down' },
        { name: '充值金额 每月累计',      value: 6408, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 7501, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 1949, trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.58, trend: 'down' },
        { name: '月充值ARPPU',           value: 3.288,trend: 'down' },
        { name: '销量 每月累计',          value: 50,   trend: 'down' }
      ],
      DTH: [
        { name: '新增用户数 每月累计',    value: 425,    trend: 'down' },
        { name: '在线用户数 每月去重',    value: 349860, trend: 'down' },
        { name: '注册用户数 月末最后一天',value: 1101568,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 190787, trend: 'down' },
        { name: '充值金额 每月累计',      value: 289402, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 339611, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 85237,  trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.562,  trend: 'down' },
        { name: '月充值ARPPU',           value: 3.395,  trend: 'down' }
      ],
      DTT: [
        { name: '新增用户数 每月累计',    value: 249,    trend: 'down' },
        { name: '在线用户数 每月去重',    value: 344459, trend: 'down' },
        { name: '注册用户数 月末最后一天',value: 1848112,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 180694, trend: 'down' },
        { name: '充值金额 每月累计',      value: 263016, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 340802, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 112640, trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.53,   trend: 'down' },
        { name: '月充值ARPPU',           value: 2.335,  trend: 'down' }
      ],
      OTT: [
        { name: '新增用户 本月累计',       value: 13426,  trend: 'up'  },
        { name: 'App日活 本月日均',       value: 46168,  trend: 'up'  },
        { name: 'App月活 本月日均',       value: 371110, trend: 'up'  },
        { name: '会员充值金额 本月累计',   value: 2365.15,trend: 'up'  },
        { name: 'DVB充值金额 本月累计',    value: 1782.63,trend: 'up'  },
        { name: '绑卡续费率 本月日均',     value: 31.74,  trend: 'up'  },
        { name: 'DSP广告收入 本月累计',   value: 9.78,   trend: 'up'  }
      ]
    };

    function classifyMacro(bizId, metricName) {
      if (bizId === 'Solar') return 'Solar';
      if (/广告|DSP/.test(metricName)) return 'AdsDevices';
      if (/销量|终端|机顶盒|设备/.test(metricName) && bizId !== 'Solar') {
        return 'AdsDevices';
      }
      return 'Subscription';
    }

    var usedArcDeg = 280;
    var startDeg = -usedArcDeg / 2;
    var cursorDeg = startDeg;
    macroDefs.forEach(function (m) {
      var sweep = usedArcDeg * (m.value / totalMacro);
      m.startDeg = cursorDeg;
      m.endDeg   = cursorDeg + sweep;
      cursorDeg += sweep;
    });

    function getMacroDef(id) {
      return macroDefs.find(function (m) { return m.id === id; });
    }
    function getMacroIndex(id) {
      return macroDefs.findIndex(function (m) { return m.id === id; });
    }
    function getBizDef(id) {
      return businessDefs.find(function (b) { return b.id === id; });
    }

    var maxRadius = 105;

    // 生成更分散、更大的 KPI 星团
    var clusterPoints = [];
    businessDefs.forEach(function (biz) {
      var metrics = kpiRaw[biz.id] || [];
      if (!metrics.length) return;

      var maxVal = metrics.reduce(function (m, x) {
        return Math.max(m, x.value);
      }, 0.0001);

      metrics.forEach(function (m) {
        var macroId = classifyMacro(biz.id, m.name);
        var macro = getMacroDef(macroId);
        if (!macro) return;

        // 每个指标复制 4~7 个点，拉开角度和半径
        var copies = 4 + Math.round((m.value / maxVal) * 3); // 4-7
        var valueRatio = m.value / maxVal;

        for (var i = 0; i < copies; i++) {
          var angle =
            macro.startDeg +
            (macro.endDeg - macro.startDeg) *
              (0.06 + 0.88 * Math.random()); // 几乎整个扇区都可占据

          var bandIndex = getMacroIndex(macroId); // 0,1,2
          var baseBandRadius = 42 + bandIndex * 18;          // 三个大圈
          var extraRingShift = (Math.random() - 0.5) * 10;   // 向内向外轻微漂移
          var jitter = 10 + 15 * Math.random();              // 更大随机带

          var radius = baseBandRadius + extraRingShift + jitter;

          var baseSize = 8 + 10 * Math.sqrt(valueRatio);
          var size     = baseSize * (0.9 + Math.random() * 0.4);

          var trend = m.trend || 'flat';
          var depth = radius / maxRadius;
          var alphaBase = 0.5 + 0.35 * depth;

          var color;
          if (trend === 'up') {
            // 橙色上升
            color = 'rgba(249,115,22,' + alphaBase + ')';
          } else if (trend === 'down') {
            // 蓝色下降
            color = 'rgba(59,130,246,' + alphaBase + ')';
          } else {
            color = toneColor(biz.tone, alphaBase);
          }

          clusterPoints.push({
            value: [radius, angle],
            bizId: biz.id,
            bizLabel: biz.label,
            macroId: macroId,
            macroLabel: macro.label,
            metric: m.name,
            rawValue: m.value,
            trend: trend,
            symbolSize: size,
            itemStyle: {
              color: color,
              opacity: 0.96,
              shadowBlur: 20 + 12 * depth,
              shadowColor: color
            }
          });
        }
      });
    });

    // === ECharts 配置 ===
    var option = {
      backgroundColor: 'transparent',
      tooltip: {
        trigger: 'item',
        formatter: function (params) {
          var d = params.data || {};
          if (!d.metric) return d.name || d.macroLabel || '';
          var trendText =
            d.trend === 'up'   ? '趋势：上升'
          : d.trend === 'down' ? '趋势：下降'
          : '趋势：相对平稳';
          return [
            d.macroLabel + ' · ' + d.bizLabel,
            d.metric,
            '当前值：' + d.rawValue,
            trendText
          ].join('<br/>');
        }
      },

      polar: {
        center: ['50%', '52%'],
        radius: '95%'
      },
      angleAxis: {
        type: 'value',
        min: -180,
        max: 180,
        startAngle: 90,
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { show: false }
      },
      radiusAxis: {
        type: 'value',
        min: 0,
        max: maxRadius,
        splitNumber: 6,
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: {
          show: true,
          lineStyle: { color: 'rgba(15,23,42,0.6)' }
        }
      },

      series: [
        // 背景同心圆 + 中央白色恒星
        {
          type: 'custom',
          coordinateSystem: 'none',
          renderItem: function (params, api) {
            var cx = api.getWidth() / 2;
            var cy = api.getHeight() * 0.52;
            var maxR = Math.min(api.getWidth(), api.getHeight()) * 0.40;
            var rings = [];
            for (var i = 1; i <= 6; i++) {
              rings.push({
                type: 'circle',
                shape: { cx: cx, cy: cy, r: (maxR / 6) * i },
                style: {
                  stroke: 'rgba(15,23,42,' + (0.35 + i * 0.05) + ')',
                  fill: 'transparent',
                  lineWidth: 1
                }
              });
            }
            // 中央白光恒星
            rings.push({
              type: 'circle',
              shape: { cx: cx, cy: cy, r: maxR * 0.12 },
              style: {
                fill: 'rgba(248,250,252,0.98)',
                shadowBlur: 70,
                shadowColor: 'rgba(248,250,252,0.95)'
              }
            });
            // 外面再叠一层暗晕，形成深度
            rings.push({
              type: 'circle',
              shape: { cx: cx, cy: cy, r: maxR * 0.24 },
              style: {
                fill: 'rgba(15,23,42,0.9)',
                shadowBlur: 55,
                shadowColor: 'rgba(15,23,42,0.95)'
              }
            });
            return { type: 'group', children: rings };
          },
          data: [0],
          silent: true,
          zlevel: 0
        },

        // 自定义三束“极光”收入光带
        {
          type: 'custom',
          coordinateSystem: 'none',
          renderItem: function (params, api) {
            var shapes = [];
            var cx = api.getWidth() / 2;
            var cy = api.getHeight() * 0.52;
            var maxR = Math.min(api.getWidth(), api.getHeight()) * 0.40;
            var rInner = maxR * 0.28;
            var rOuter = maxR * 0.64;

            macroDefs.forEach(function (m, idx) {
              var startAngle = (m.startDeg * Math.PI) / 180;
              var endAngle   = (m.endDeg   * Math.PI) / 180;

              var auroraColor;
              if (m.id === 'Subscription') {
                auroraColor = new echarts.graphic.LinearGradient(
                  0.5, 0.2, 0.5, 1,
                  [
                    { offset: 0,   color: 'rgba(34,211,238,0.95)' },
                    { offset: 0.45,color: 'rgba(59,130,246,0.4)' },
                    { offset: 1,   color: 'rgba(15,23,42,0)' }
                  ]
                );
              } else if (m.id === 'Solar') {
                auroraColor = new echarts.graphic.LinearGradient(
                  0.5, 0.1, 0.5, 1,
                  [
                    { offset: 0,   color: 'rgba(190,242,100,0.95)' },
                    { offset: 0.5, color: 'rgba(45,212,191,0.4)' },
                    { offset: 1,   color: 'rgba(15,23,42,0)' }
                  ]
                );
              } else { // Ads & Devices
                auroraColor = new echarts.graphic.LinearGradient(
                  0.5, 0.2, 0.5, 1,
                  [
                    { offset: 0,   color: 'rgba(244,114,182,0.96)' },
                    { offset: 0.5, color: 'rgba(251,191,36,0.45)' },
                    { offset: 1,   color: 'rgba(15,23,42,0)' }
                  ]
                );
              }

              shapes.push({
                type: 'sector',
                shape: {
                  cx: cx,
                  cy: cy,
                  r0: rInner,
                  r: rOuter,
                  startAngle: startAngle,
                  endAngle: endAngle
                },
                style: {
                  fill: auroraColor,
                  stroke: 'none',
                  shadowBlur: 60,
                  shadowColor: m.color
                }
              });
            });

            return { type: 'group', children: shapes };
          },
          data: [0],
          silent: true,
          zlevel: 1
        },

        // KPI 星团：发光散点 + 景深
        {
          type: 'effectScatter',
          coordinateSystem: 'polar',
          name: 'KPI Cluster',
          encode: { radius: 0, angle: 1 },
          data: clusterPoints,
          symbolSize: function (val, params) {
            return params.data.symbolSize || 8;
          },
          rippleEffect: {
            brushType: 'stroke',
            scale: 2.8,
            period: 12
          },
          zlevel: 3
        }
      ]
    };

    chart.setOption(option);
    window.addEventListener('resize', function () {
      chart.resize();
    });
  </script>
</body>
</html>
