<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Ecology · Business Constellation · StarTimes Uganda</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- DIN 风格字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;500;600;700&family=Barlow:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-dark: #050816;
      --glass-bg: rgba(20, 25, 40, 0.65);
      --glass-border: rgba(255, 255, 255, 0.15);
      --glass-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.7);
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;

      --c-sub:   #06b6d4; /* Content Blue */
      --c-solar: #10b981; /* Solar Green */
      --c-dev:   #f97316; /* Devices / Ads Amber */

      --font-din:  'Barlow', sans-serif;
      --font-cond: 'Barlow Condensed', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-din);
      background: var(--bg-dark);
      color: var(--text-main);
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      background-image: 
        radial-gradient(circle at 50% 60%, rgba(15, 23, 42, 1) 0%, transparent 80%),
        radial-gradient(circle at 85% 20%, rgba(6, 182, 212, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 15% 80%, rgba(16, 185, 129, 0.05) 0%, transparent 20%);
    }

    /* 顶部：品牌 + 面包屑 + 扇区导航 + 返回 */
    .top-bar {
      position: fixed; top: 0; left: 0; right: 0; height: 72px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 40px; z-index: 20;
      background: linear-gradient(to bottom, rgba(5,8,22,0.95), transparent);
      pointer-events: none;
    }
    .brand { pointer-events: auto; display: flex; flex-direction: column; }
    .brand-path {
      font-family: var(--font-cond); font-size: 11px; letter-spacing: 1.5px;
      text-transform: uppercase; color: var(--c-sub); opacity: 0.9; margin-bottom: 4px; font-weight: 600;
    }
    .brand-title {
      font-family: var(--font-cond); font-size: 18px; font-weight: 600;
      letter-spacing: 0.6px; text-transform: uppercase; color: #fff;
    }
    .top-actions { pointer-events: auto; display: flex; align-items: center; gap: 16px; }

    .breadcrumb {
      pointer-events:auto;
      font-family: var(--font-cond);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.4px;
      color: rgba(148,163,184,0.9);
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      top:12px;
      display:flex;
      gap:6px;
      align-items:center;
    }
    .crumb-sep { opacity:0.6; }
    .crumb-active { color:#e5e7eb; }

    .sector-nav {
      position:absolute;
      top:38px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:10px;
      pointer-events:auto;
    }
    .sector-chip {
      font-family: var(--font-cond);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding:4px 14px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      text-decoration:none;
      display:flex;
      align-items:center;
      gap:6px;
      box-shadow:0 6px 16px rgba(0,0,0,0.35);
      transition:all .25s ease;
    }
    .sector-chip-dot {
      width:8px;height:8px;border-radius:999px;background:#6b7280;
    }
    .sector-chip.sub   .sector-chip-dot { background:var(--c-sub); }
    .sector-chip.solar .sector-chip-dot { background:var(--c-solar); }
    .sector-chip.dev   .sector-chip-dot { background:var(--c-dev); }

    .sector-chip:hover {
      transform:translateY(-1px);
      border-color:rgba(248,250,252,0.9);
      box-shadow:0 8px 22px rgba(15,23,42,0.9);
    }

    .back-btn {
      font-family: var(--font-cond); font-size: 14px; font-weight: 600;
      padding: 8px 28px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08); color: var(--text-main);
      text-decoration: none; border: 1px solid rgba(255,255,255,0.2);
      backdrop-filter: blur(12px);
      text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .back-btn:hover {
      background: var(--c-sub); color: #000; border-color: var(--c-sub);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(6, 182, 212, 0.4);
    }

    #chart-container { position: absolute; inset: 0; z-index: 1; }

    .panel-layer { position: absolute; inset: 0; pointer-events: none; z-index: 10; padding: 40px; }

    /* 左上主说明（不抢占鼠标事件） */
    .hero-text {
      position: absolute; top: 96px; left: 50px; max-width: 420px;
      text-shadow: 0 4px 30px rgba(0,0,0,0.8);
      pointer-events: none;
      user-select: none;
    }
    .hero-label {
      font-family: var(--font-cond); font-size: 12px; font-weight: 700;
      color: var(--c-sub); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; letter-spacing: 1.5px;
    }
    .hero-title {
      font-family: var(--font-cond); font-size: 52px; font-weight: 700; line-height: 0.9; margin-bottom: 24px;
      text-transform: uppercase; letter-spacing: -1px;
      background: linear-gradient(180deg, #fff 0%, #94a3b8 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .hero-desc {
      font-size: 14px; line-height: 1.6; font-weight: 300; color: var(--text-muted);
      position: relative;
      padding-left: 20px; margin-bottom: 32px;
    }
    .hero-desc::before {
      content: ''; position: absolute; left: 0; top: 4px; bottom: 4px; width: 4px;
      background: rgba(255,255,255,0.2); border-radius: 4px;
    }
    .struct-legend { display: flex; flex-direction: column; gap: 16px; }
    .struct-item { display: flex; align-items: center; gap: 14px; color: rgba(255,255,255,0.9); }
    .struct-bar { width: 6px; height: 32px; border-radius: 6px; box-shadow: 0 0 12px currentColor; }
    .struct-info { display: flex; flex-direction: column; justify-content: center; }
    .struct-pct { font-family: var(--font-mono); font-weight: 700; font-size: 18px; line-height: 1; margin-bottom: 2px; }
    .struct-name { font-family: var(--font-cond); font-size: 12px; text-transform: uppercase; opacity: 0.7; letter-spacing: 0.5px; }

    .glass-card {
      position: absolute; width: 320px; padding: 28px;
      border-radius: 32px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
      box-shadow: var(--glass-shadow);
      pointer-events: auto; opacity: 0; transform: translateY(30px);
      transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    }
    .glass-card.active { opacity: 1; transform: translateY(0); }

    .card-header {
      font-family: var(--font-cond); font-size: 13px; font-weight: 700;
      color: rgba(255,255,255,0.6); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .card-title {
      font-family: var(--font-cond); font-size: 24px; font-weight: 600; color: #fff; margin-bottom: 16px;
      text-transform: uppercase; letter-spacing: 0.5px; line-height: 1.2;
    }
    .metric-val { font-family: var(--font-mono); font-size: 36px; font-weight: 400; color: #fff; display: block; margin-bottom: 4px; }
    .metric-label { font-family: var(--font-cond); font-size: 12px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; }

    .pos-bottom-right { bottom: 50px; right: 50px; }

    @media (max-width: 768px) {
      .top-bar { padding: 0 20px; height: 60px; }
      .hero-text { top: 80px; left: 24px; right: 24px; max-width: none; }
      .hero-title { font-size: 40px; }
      .glass-card { left: 24px; right: 24px; bottom: 24px; width: auto; border-radius: 24px; }
      .breadcrumb,.sector-nav { display:none; }
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <div class="brand">
      <div class="brand-path">STARTIMES / UGANDA / ECOLOGY</div>
      <div class="brand-title">Business Constellation</div>
    </div>
    <div class="top-actions">
      <a class="back-btn" href="../index.html">Back to Universe</a>
    </div>

    <div class="breadcrumb">
      <span>Data Space</span><span class="crumb-sep">/</span>
      <span>Ecology</span><span class="crumb-sep">/</span>
      <span class="crumb-active">Business Constellation</span>
    </div>

    <div class="sector-nav">
      <a class="sector-chip sub" href="./ecology-dvb.html">
        <span class="sector-chip-dot"></span><span>DVB · TV Ecosystem</span>
      </a>
      <a class="sector-chip solar" href="./solar.html">
        <span class="sector-chip-dot"></span><span>Solar · Off-grid Power</span>
      </a>
      <a class="sector-chip dev" href="./content.html">
        <span class="sector-chip-dot"></span><span>Content · OTT &amp; Ads</span>
      </a>
    </div>
  </div>

  <div id="chart-container"></div>

  <div class="panel-layer">
    <!-- 左上：总览说明 -->
    <div class="hero-text">
      <div class="hero-label">ECOSYSTEM OVERVIEW</div>
      <h1 class="hero-title">Business<br>Planetary System</h1>
      <div class="hero-desc">
        从两个维度来观察企业生态，横向，乌干达四达的产业产品布局；纵向，产业产品特点，门槛与不可替代性；
        本图表呈现乌干达四达整体业务重心概览；三个不同颜色的扇区分别代表
        Subscription <strong>63%</strong>、Solar <strong>30%</strong>、
        Ads &amp; Devices <strong>7%</strong> 的收入组成。包含五项主要业务
        （Solar / DTV / DTH / DTT / OTT），KPI 数据点按照指
        标属性分布在各自收入扇区中，部分“终端 / 设备 / 广告”类指标
        被跃迁到 <em>Ads &amp; Devices</em> 扇区。
      </div>

      <div class="struct-legend">
        <div class="struct-item">
          <div class="struct-bar" style="background:var(--c-sub); color:var(--c-sub)"></div>
          <div class="struct-info">
            <span class="struct-pct" style="color:var(--c-sub)">63%</span>
            <span class="struct-name">Content Subscription</span>
          </div>
        </div>
        <div class="struct-item">
          <div class="struct-bar" style="background:var(--c-solar); color:var(--c-solar)"></div>
          <div class="struct-info">
            <span class="struct-pct" style="color:var(--c-solar)">30%</span>
            <span class="struct-name">Solar Energy</span>
          </div>
        </div>
        <div class="struct-item">
          <div class="struct-bar" style="background:var(--c-dev); color:var(--c-dev)"></div>
          <div class="struct-info">
            <span class="struct-pct" style="color:var(--c-dev)">07%</span>
            <span class="struct-name">Devices &amp; Advertising</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 右下：指标详情卡 -->
    <div class="glass-card pos-bottom-right" id="detail-panel">
      <div class="card-header">
        <span id="p-biz">BUSINESS</span>
        <span id="p-type" style="color:var(--c-sub)">SECTOR</span>
      </div>
      <div class="card-title" id="p-name">Metric Name</div>
      <div style="margin-bottom:16px;">
         <span class="metric-val" id="p-val">0</span>
         <span class="metric-label">Current Value</span>
      </div>
      <div style="border-top:1px solid rgba(255,255,255,0.1); padding-top:16px; font-family:var(--font-din); font-size:13px; color:rgba(255,255,255,0.8); display:flex; align-items:center; gap:8px;">
        Trend Status:
        <span id="p-trend" style="font-weight:bold; font-size:14px; padding:2px 8px; border-radius:12px; background:rgba(255,255,255,0.1);">--</span>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script>
    // 视角状态：旋转 + 缩放 + 极光进度
    var viewState = {
      rotationDeg: 0,
      zoom: 1,
      auroraProgress: 1
    };

    var macroDefs = [
      { id: 'Subscription', label: 'Subscription', value: 63, color: '#06b6d4' },
      { id: 'Solar',        label: 'Solar',        value: 30, color: '#10b981' },
      { id: 'AdsDevices',   label: 'Ads & Devices',value: 7,  color: '#f97316' }
    ];

    var businessDefs = [
      { id: 'Solar', label: 'SOLAR', tone: 'green' },
      { id: 'DTV',   label: 'DTV',   tone: 'blue'  },
      { id: 'DTH',   label: 'DTH',   tone: 'cyan'  },
      { id: 'DTT',   label: 'DTT',   tone: 'indigo'},
      { id: 'OTT',   label: 'OTT',   tone: 'violet'}
    ];

    function toneColor(tone, alpha) {
      if (tone === 'green')  return 'rgba(74,222,128,'  + alpha + ')';
      if (tone === 'blue')   return 'rgba(59,130,246,' + alpha + ')';
      if (tone === 'cyan')   return 'rgba(34,211,238,' + alpha + ')';
      if (tone === 'indigo') return 'rgba(129,140,248,'+ alpha + ')';
      if (tone === 'violet') return 'rgba(192,132,252,'+ alpha + ')';
      return 'rgba(148,163,184,'+ alpha + ')';
    }

    var gap = 0.5;
    var effectiveTotal = 100 - macroDefs.length * gap;
    var currentVal = 0;
    var macroLayout = {};
    ['Subscription','Solar','AdsDevices'].forEach(function(id) {
      var m = macroDefs.find(function(x){return x.id===id;});
      var span = (m.value / 100) * effectiveTotal;
      macroLayout[id] = {
        start: currentVal,
        end: currentVal + span,
        mid: currentVal + span/2,
        color: m.color,
        label: m.label
      };
      currentVal += span + gap;
    });

    var planetPoints = [];
    var planetMap = {};
    businessDefs.forEach(function(biz){
      var targetMacroId = 'Subscription';
      if (biz.id === 'Solar') targetMacroId = 'Solar';

      var layout = macroLayout[targetMacroId];
      var angleVal = layout.mid;

      if (targetMacroId === 'Subscription') {
        var subBizs = ['DTV','DTH','DTT','OTT'];
        var idx = subBizs.indexOf(biz.id);
        var step = (layout.end - layout.start) / (subBizs.length + 1);
        if (idx >= 0) angleVal = layout.start + step * (idx + 1);
      }

      var radius = 60;

      planetPoints.push({
        name: biz.label,
        value: [radius, angleVal],
        itemStyle: {
          color: toneColor(biz.tone, 0.95),
          borderColor: 'rgba(255,255,255,0.9)',
          borderWidth: 2,
          shadowBlur: 30,
          shadowColor: 'rgba(15,23,42,0.8)'
        }
      });
      planetMap[biz.id] = { radius: radius, angle: angleVal, tone: biz.tone, label: biz.label };
    });

    var kpiRaw = {
      Solar: [
        { name: '销量 每月累计',          value: 1481,     trend: 'down' },
        { name: '销售收入(应收) 每月累计', value: 168973,   trend: 'down' },
        { name: '全款收款 每月累计',      value: 1148,     trend: 'down' },
        { name: '首付款收款 每月累计',    value: 10171,    trend: 'down' },
        { name: '分期款收款 每月累计',    value: 80729,    trend: 'down' },
        { name: '累计应收分期款 月末',    value: 23072112, trend: 'up'   },
        { name: '当月应收分期款 月末',    value: 224472,   trend: 'down' },
        { name: '分期中用户数 月末',      value: 234390,   trend: 'up'   }
      ],
      DTV: [
        { name: '新增用户数 每月累计',    value: 110,   trend: 'down' },
        { name: '在线用户数 每月去重',    value: 8112, trend: 'down' },
        { name: '注册用户数 月末',        value: 39510,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 4353, trend: 'down' },
        { name: '充值金额 每月累计',      value: 6408, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 7501, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 1949, trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.58, trend: 'down' },
        { name: '月充值ARPPU',           value: 3.288,trend: 'down' },
        { name: '销量 每月累计',          value: 50,   trend: 'down' }
      ],
      DTH: [
        { name: '新增用户数 每月累计',    value: 425,    trend: 'down' },
        { name: '在线用户数 每月去重',    value: 349860, trend: 'down' },
        { name: '注册用户数 月末',        value: 1101568,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 190787, trend: 'down' },
        { name: '充值金额 每月累计',      value: 289402, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 339611, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 85237,  trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.562,  trend: 'down' },
        { name: '月充值ARPPU',           value: 3.395,  trend: 'down' }
      ],
      DTT: [
        { name: '新增用户数 每月累计',    value: 249,    trend: 'down' },
        { name: '在线用户数 每月去重',    value: 344459, trend: 'down' },
        { name: '注册用户数 月末',        value: 1848112,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 180694, trend: 'down' },
        { name: '充值金额 每月累计',      value: 263016, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 340802, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 112640, trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.53,   trend: 'down' },
        { name: '月充值ARPPU',           value: 2.335,  trend: 'down' }
      ],
      OTT: [
        { name: '新增用户 本月累计',       value: 13426,  trend: 'up'  },
        { name: 'App日活 本月日均',       value: 46168,  trend: 'up'  },
        { name: 'App月活 本月日均',       value: 371110, trend: 'up'  },
        { name: '会员充值金额 本月累计',   value: 2365.15,trend: 'up'  },
        { name: 'DVB充值金额 本月累计',    value: 1782.63,trend: 'up'  },
        { name: '绑卡续费率 本月日均',     value: 31.74,  trend: 'up'  },
        { name: 'DSP广告收入 本月累计',   value: 9.78,   trend: 'up'  }
      ]
    };

    function classifyMacro(bizId, metricName) {
      if (bizId === 'Solar') return 'Solar';
      if (/广告|DSP/.test(metricName)) return 'AdsDevices';
      if (/销量|新.*用户|终端|设备|机顶盒/.test(metricName) && bizId !== 'Solar') {
        return 'AdsDevices';
      }
      return 'Subscription';
    }

    var MAX_RADIUS = 100;

    var clusterPoints = [];
    businessDefs.forEach(function(biz){
      var metrics = kpiRaw[biz.id] || [];
      if (!metrics.length) return;

      var planet = planetMap[biz.id];
      var maxVal = metrics.reduce(function(m,x){return Math.max(m, x.value);}, 0.0001);

      metrics.forEach(function(m){
        var macroId = classifyMacro(biz.id, m.name);
        var layout = macroLayout[macroId];

        var angle, radius;
        if (macroId === 'AdsDevices') {
          var span = layout.end - layout.start;
          angle = layout.start + span * (0.18 + 0.64 * Math.random());
          radius = 70 + Math.random()*22;
        } else {
          angle = planet.angle + (Math.random()-0.5) * 10;
          radius = planet.radius + (Math.random()-0.5) * 18;
        }

        var ratio = m.value / maxVal;
        var size = 12 + 16 * Math.sqrt(ratio);

        var fillColor = toneColor(planet.tone, 0.9);
        var borderColor = 'rgba(226,232,240,0.8)';
        if (m.trend === 'up')   borderColor = '#f97316';
        else if (m.trend === 'down') borderColor = '#3b82f6';

        clusterPoints.push({
          value: [radius, angle],
          info: {
            name: m.name,
            value: m.value,
            trend: m.trend,
            biz: planet.label,
            type: layout.label
          },
          symbolSize: size,
          itemStyle: {
            color: fillColor,
            opacity: 0.95,
            borderColor: borderColor,
            borderWidth: 2,
            shadowBlur: 26,
            shadowColor: borderColor
          }
        });
      });
    });

    // 星场
    var starfield = [];
    (function(){
      var count = 260;
      for (var i=0;i<count;i++){
        var radius = 20 + Math.random()*(MAX_RADIUS-15);
        var angle = Math.random()*100;
        var alpha = 0.15 + 0.5*Math.random();
        starfield.push({
          value: [radius, angle],
          symbolSize: 1 + 2.5*Math.random(),
          itemStyle: {
            color: 'rgba(248,250,252,' + alpha + ')',
            opacity: 1
          }
        });
      }
    })();

    var chart = echarts.init(document.getElementById('chart-container'));

    var option = {
      backgroundColor: 'transparent',
      tooltip: { show: false },
      polar: { center: ['50%','52%'], radius: '120%' },
      angleAxis: {
        type: 'value',
        min: 0,
        max: 100,
        show: false,
        startAngle: 90,
        clockwise: true
      },
      radiusAxis: {
        type: 'value',
        min: 0,
        max: MAX_RADIUS,
        show: false
      },
      series: [
        // 极光扇区
        {
          id: 'aurora',
          type: 'custom',
          coordinateSystem: 'none',
          data: [1],
          renderItem: function(params, api){
            var progress = viewState.auroraProgress;
            var cx = api.getWidth()/2;
            var cy = api.getHeight()*0.52;
            var maxR = Math.min(api.getWidth(), api.getHeight())*0.50*viewState.zoom;
            var rInner = maxR*0.18*progress;
            var rOuter = maxR*(0.30 + 0.42*progress);
            var rot = viewState.rotationDeg * Math.PI/180;

            var children = [];
            ['Subscription','Solar','AdsDevices'].forEach(function(id){
              var lay = macroLayout[id];
              var startRad = (lay.start/100)*Math.PI*2 - Math.PI/2 + rot;
              var endRad   = (lay.end/100)*Math.PI*2   - Math.PI/2 + rot;
              for (var layer=0; layer<3; layer++){
                var inner = rInner + layer*maxR*0.01;
                var outer = rOuter + layer*maxR*0.015;
                var alphaMul = 1 - layer*0.35;
                var grad;
                if (id === 'Subscription') {
                  grad = new echarts.graphic.LinearGradient(0.5,0.0,0.5,1,[
                    {offset:0,  color:'rgba(34,211,238,' + (0.96*alphaMul) + ')'},
                    {offset:0.5,color:'rgba(59,130,246,' + (0.40*alphaMul) + ')'},
                    {offset:1,  color:'rgba(15,23,42,0)'}
                  ]);
                } else if (id === 'Solar') {
                  grad = new echarts.graphic.LinearGradient(0.5,0.0,0.5,1,[
                    {offset:0,  color:'rgba(190,242,100,' + (0.96*alphaMul) + ')'},
                    {offset:0.5,color:'rgba(45,212,191,' + (0.40*alphaMul) + ')'},
                    {offset:1,  color:'rgba(15,23,42,0)'}
                  ]);
                } else {
                  grad = new echarts.graphic.LinearGradient(0.5,0.0,0.5,1,[
                    {offset:0,  color:'rgba(244,114,182,' + (0.96*alphaMul) + ')'},
                    {offset:0.5,color:'rgba(251,191,36,' + (0.45*alphaMul) + ')'},
                    {offset:1,  color:'rgba(15,23,42,0)'}
                  ]);
                }
                children.push({
                  type:'sector',
                  shape:{cx:cx,cy:cy,r0:inner,r:outer,startAngle:startRad,endAngle:endRad},
                  style:{
                    fill:grad,
                    stroke:'none',
                    shadowBlur:80*progress,
                    shadowColor:lay.color
                  }
                });
              }
            });
            return {type:'group',children:children};
          },
          silent:true,
          zlevel:1
        },

        // 轨道圈
        {
          id:'rings',
          type:'custom',
          coordinateSystem:'none',
          data:[0],
          renderItem:function(params, api){
            var cx = api.getWidth()/2;
            var cy = api.getHeight()*0.52;
            var maxR = Math.min(api.getWidth(), api.getHeight())*0.50*viewState.zoom;
            var rings=[];
            [0.32,0.46,0.60,0.74,0.88].forEach(function(rp){
              rings.push({
                type:'circle',
                shape:{cx:cx,cy:cy,r:maxR*rp},
                style:{fill:'none',stroke:'rgba(15,23,42,0.9)',lineWidth:1}
              });
            });
            return {type:'group',children:rings};
          },
          silent:true,
          zlevel:0
        },

        // 中央恒星
        {
          id:'star',
          type:'custom',
          coordinateSystem:'none',
          data:[0],
          renderItem:function(params, api){
            var cx = api.getWidth()/2;
            var cy = api.getHeight()*0.52;
            var maxR = Math.min(api.getWidth(), api.getHeight())*0.50*viewState.zoom;
            var haloR = maxR*0.16;
            var starR = maxR*0.09;
            return {
              type:'group',
              children:[
                {
                  type:'circle',
                  shape:{cx:cx,cy:cy,r:haloR},
                  style:{
                    fill:new echarts.graphic.RadialGradient(0.5,0.5,1,[
                      {offset:0,color:'rgba(248,250,252,0.8)'},
                      {offset:0.4,color:'rgba(248,250,252,0.28)'},
                      {offset:1,color:'rgba(15,23,42,0)'}
                    ]),
                    shadowBlur:70,
                    shadowColor:'rgba(248,250,252,0.9)'
                  }
                },
                {
                  type:'circle',
                  shape:{cx:cx,cy:cy,r:starR},
                  style:{
                    fill:'rgba(248,250,252,0.98)',
                    shadowBlur:32,
                    shadowColor:'rgba(248,250,252,0.95)'
                  }
                }
              ]
            };
          },
          silent:true,
          zlevel:3
        },

        // 星场
        {
          type:'scatter',
          name:'Starfield',
          coordinateSystem:'polar',
          data: starfield,
          symbolSize:function(val,params){return params.data.symbolSize || 2;},
          itemStyle:{color:'rgba(248,250,252,0.8)'},
          silent:true,
          zlevel:2
        },

        // 行星
        {
          type:'scatter',
          name:'Planets',
          coordinateSystem:'polar',
          data: planetPoints,
          symbolSize:26,
          label:{
            show:true,
            formatter:'{b}',
            position:'top',
            color:'#e5e7eb',
            fontFamily:'Barlow Condensed',
            fontSize:14,
            fontWeight:600
          },
          zlevel:4
        },

        // KPI 星团
        {
          type:'effectScatter',
          name:'KPI Cluster',
          coordinateSystem:'polar',
          data: clusterPoints,
          symbolSize:function(val,params){return params.data.symbolSize;},
          rippleEffect:{
            scale:2.3,
            brushType:'stroke',
            period:12
          },
          zlevel:5
        }
      ]
    };

    chart.setOption(option);

    // 极光入场动画
    (function animateAurora(){
      var start = Date.now();
      var duration = 1300;
      function frame(){
        var now = Date.now();
        var t = (now-start)/duration;
        if (t>1) t=1;
        viewState.auroraProgress = t;
        chart.setOption({
          series:[{id:'aurora', data:[t]}]
        }, false);
        if (t<1) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    })();

    // 悬停详情（包括 Solar 区域）
    var panel = document.getElementById('detail-panel');
    chart.on('mousemove', function(params){
      if (params.seriesType !== 'effectScatter') return;
      if (!params.data || !params.data.info) return;

      var d = params.data.info;

      var elVal   = document.getElementById('p-val');
      var elName  = document.getElementById('p-name');
      var elTrend = document.getElementById('p-trend');
      var elBiz   = document.getElementById('p-biz');
      var elType  = document.getElementById('p-type');

      elName.textContent = d.name;
      elVal.textContent  = d.value.toLocaleString();

      var color = '#e5e7eb';
      if (d.trend === 'up')   color = '#f97316';
      else if (d.trend === 'down') color = '#3b82f6';
      elVal.style.color = color;

      elTrend.textContent = d.trend ? d.trend.toUpperCase() : '--';
      elTrend.style.color = color;
      elTrend.style.background =
        d.trend === 'up'   ? 'rgba(249,115,22,0.12)' :
        d.trend === 'down' ? 'rgba(59,130,246,0.12)' :
                             'rgba(148,163,184,0.15)';

      elBiz.textContent  = d.biz;
      elType.textContent = d.type;

      panel.classList.add('active');
    });

    // 2.5D 旋转（拖动）与缩放（滚轮）
    var zr = chart.getZr();
    var isDragging = false;
    var lastX = 0;

    zr.on('mousedown', function(e){
      isDragging = true;
      lastX = e.offsetX;
    });
    zr.on('mouseup', function(){ isDragging = false; });
    zr.on('globalout', function(){ isDragging = false; });

    zr.on('mousemove', function(e){
      if (!isDragging) return;
      var dx = e.offsetX - lastX;
      lastX = e.offsetX;
      viewState.rotationDeg = (viewState.rotationDeg + dx * 0.25) % 360;
      chart.setOption({
        angleAxis:{ startAngle: 90 + viewState.rotationDeg },
        series:[
          {id:'aurora', data:[viewState.auroraProgress]},
          {id:'rings',  data:[0]},
          {id:'star',   data:[0]}
        ]
      }, false);
    });

    var dom = chart.getDom();
    dom.addEventListener('wheel', function(e){
      e.preventDefault();
      var delta = e.deltaY > 0 ? -0.08 : 0.08;
      var z = viewState.zoom + delta;
      if (z < 0.75) z = 0.75;
      if (z > 1.35) z = 1.35;
      viewState.zoom = z;
      chart.setOption({
        polar:{ radius: (120 * viewState.zoom) + '%' },
        series:[
          {id:'aurora', data:[viewState.auroraProgress]},
          {id:'rings',  data:[0]},
          {id:'star',   data:[0]}
        ]
      }, false);
    }, { passive:false });

    window.addEventListener('resize', function(){ chart.resize(); });
  </script>
</body>
</html>
