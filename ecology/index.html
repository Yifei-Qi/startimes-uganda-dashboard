<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Ecology · Business Constellation · StarTimes Uganda</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont,"SF Pro Text",
        "Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans SC",sans-serif;
      background: #050816;
      color: #e5e7eb;
      overflow: hidden;
    }

    .top-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 26px;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: linear-gradient(
        to bottom,
        rgba(5,7,24,0.96),
        rgba(5,7,24,0.75),
        transparent
      );
      border-bottom: 1px solid rgba(148,163,184,0.35);
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .brand-path {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #6b7280;
    }

    .brand-title {
      font-size: 16px;
      font-weight: 600;
    }

    .top-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.8);
      color: #9ca3af;
    }

    .back {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: radial-gradient(circle at top left,rgba(96,165,250,0.9),rgba(15,23,42,0.98));
      color: #e5e7eb;
      text-decoration: none;
    }

    .scene {
      position: absolute;
      top: 52px; bottom: 0; left: 0; right: 0;
      overflow: hidden;
      background:
        radial-gradient(circle at 15% 10%, rgba(56,189,248,0.24), transparent 55%),
        radial-gradient(circle at 80% 90%, rgba(234,179,8,0.28), transparent 60%),
        radial-gradient(circle at 70% 10%, rgba(244,63,94,0.18), transparent 55%),
        #020617;
    }

    #eco-orbit {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .panel {
      position: absolute;
      border-radius: 20px;
      padding: 14px 16px;
      border: 1px solid rgba(148,163,184,0.55);
      background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,0.9));
      box-shadow:
        0 18px 55px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.9) inset;
      backdrop-filter: blur(18px);
      max-width: 260px;
      font-size: 12px;
      line-height: 1.6;
      color: #9ca3af;
    }

    .panel h2 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .panel small {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #64748b;
    }

    .panel-main { left: 42px; top: 82px; }
    .panel-legacy { bottom: 42px; left: 40px; max-width: 230px; }
    .panel-new { bottom: 46px; right: 44px; max-width: 230px; }
    .panel-kpi { top: 80px; right: 40px; max-width: 230px; }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .pill {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.55);
      font-size: 11px;
      color: #cbd5f5;
    }

    @media (max-width: 900px) {
      .panel-main {
        left: 16px;
        top: 76px;
        right: 16px;
        max-width: none;
      }
      .panel-legacy,
      .panel-new,
      .panel-kpi {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="brand">
      <div class="brand-path">STARTIMES UGANDA · DATA SPACE</div>
      <div class="brand-title">Ecology · 业务星团图 Business Constellation</div>
    </div>
    <div class="top-actions">
      <div class="chip">中心 63·30·7 收入环 · 外圈 KPI 星团</div>
      <a class="back" href="../index.html">Back to Universe</a>
    </div>
  </div>

  <div class="scene">
    <div id="eco-orbit"></div>

    <aside class="panel panel-main">
      <small>OVERVIEW</small>
      <h2>收入结构 + 五条业务线的 KPI 星团</h2>
      <p>
        中心环形图展示乌干达四达三条主收入轨道：
        <strong>Subscription 63%</strong>、
        <strong>Solar 30%</strong>、
        <strong>Ads &amp; Devices 7%</strong>。
        外圈的点云则把这三大块拆开成具体业务线
        （Solar、DTV、DTH、DTT、OTT）的 KPI 星团。
      </p>
      <p style="margin-top:6px;">
        点靠近某个扇区，代表属于该收入块；点的颜色代表业务线；
        大小代表该指标在本业务内部的大致体量。
      </p>
      <div class="pill-row">
        <span class="pill">蓝色扇区 · Subscription · 63%</span>
        <span class="pill">绿色扇区 · Solar · 30%</span>
        <span class="pill">金色扇区 · Ads &amp; Devices · 7%</span>
      </div>
    </aside>

    <aside class="panel panel-legacy">
      <small>LEGACY DVB CLUSTER</small>
      <h2>DTV · DTH · DTT 电视业务星团</h2>
      <p>
        传统付费电视业务的充值、扣费、ARPPU 等指标被归入
        <strong>Subscription</strong> 扇区；其中带“销量 / 终端 / 设备”
        的指标则归入 <strong>Ads &amp; Devices</strong> 扇区。
        通过点云的密度与体量，可以看出收视费与终端收入在整个生态中的相对贡献。
      </p>
    </aside>

    <aside class="panel panel-new">
      <small>SOLAR &amp; OTT CLUSTER</small>
      <h2>Solar 与 OTT 的新增长空间</h2>
      <p>
        Solar 星团聚集于绿色扇区，代表 30% 的离网增量收入；
        OTT 星团主要落在 Subscription 扇区，但其中广告相关 KPI
        会被归入 Ads &amp; Devices。绿色与品红色点云的扩散程度，
        暗示了未来可以重点挖掘的增长星域。
      </p>
    </aside>

    <aside class="panel panel-kpi">
      <small>HOW TO READ</small>
      <h2>点的含义</h2>
      <p>
        位置：中心环外，对应所属收入扇区；<br/>
        颜色：区分业务线 Solar / DTV / DTH / DTT / OTT；<br/>
        大小：在本业务内的相对指标体量；<br/>
        悬停：查看业务线 + 指标名称 + 当前值。
      </p>
    </aside>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script>
    var dom = document.getElementById('eco-orbit');
    var chart = echarts.init(dom);

    // 三大收入块：63 / 30 / 7
    var macroDefs = [
      { id: 'Subscription', label: 'Subscription 63%', value: 63,
        color: '#60a5fa' }, // 蓝
      { id: 'Solar',        label: 'Solar 30%',        value: 30,
        color: '#22c55e' }, // 绿
      { id: 'AdsDevices',   label: 'Ads & Devices 7%', value: 7,
        color: '#eab308' }  // 金
    ];
    var totalMacro = macroDefs.reduce(function (s, m) { return s + m.value; }, 0);

    // 五条业务线：用颜色区分
    var businessDefs = [
      { id: 'Solar', label: 'Solar', tone: 'green' },
      { id: 'DTV',  label: 'DTV',  tone: 'blue'  },
      { id: 'DTH',  label: 'DTH',  tone: 'cyan'  },
      { id: 'DTT',  label: 'DTT',  tone: 'indigo'},
      { id: 'OTT',  label: 'OTT',  tone: 'violet'}
    ];

    function toneColor(tone, alpha) {
      switch (tone) {
        case 'green':  return 'rgba(34,197,94,'  + alpha + ')';
        case 'blue':   return 'rgba(59,130,246,' + alpha + ')';
        case 'cyan':   return 'rgba(45,212,191,' + alpha + ')';
        case 'indigo': return 'rgba(129,140,248,'+ alpha + ')';
        case 'violet': return 'rgba(236,72,153,' + alpha + ')';
        default:       return 'rgba(148,163,184,'+ alpha + ')';
      }
    }

    // KPI 原始数据（你截图里的主要指标，数值用于相对大小）
    var kpiRaw = {
      Solar: [
        { name: '销量 每月累计',          value: 1481,    trend: 'down' },
        { name: '销售收入(应收) 每月累计', value: 168973,  trend: 'down' },
        { name: '全款收款 每月累计',      value: 1148,    trend: 'down' },
        { name: '首付款收款 每月累计',    value: 10171,   trend: 'down' },
        { name: '分期款收款 每月累计',    value: 80729,   trend: 'down' },
        { name: '累计应收分期款',         value: 23072112,trend: 'up'   },
        { name: '当月应收分期款',         value: 224472,  trend: 'down' },
        { name: '分期中用户数',           value: 234390,  trend: 'up'   }
      ],
      DTV: [
        { name: '新增用户数 每月累计',    value: 110,   trend: 'down' },
        { name: '在线用户数 每月去重',    value: 8112, trend: 'down' },
        { name: '注册用户数 月末最后一天',value: 39510,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 4353, trend: 'down' },
        { name: '充值金额 每月累计',      value: 6408, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 7501, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 1949, trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.58, trend: 'down' },
        { name: '月充值ARPPU',           value: 3.288,trend: 'down' },
        { name: '销量 每月累计',          value: 50,   trend: 'down' }
      ],
      DTH: [
        { name: '新增用户数 每月累计',    value: 425,    trend: 'down' },
        { name: '在线用户数 每月去重',    value: 349860, trend: 'down' },
        { name: '注册用户数 月末最后一天',value: 1101568,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 190787, trend: 'down' },
        { name: '充值金额 每月累计',      value: 289402, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 339611, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 85237,  trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.562,  trend: 'down' },
        { name: '月充值ARPPU',           value: 3.395,  trend: 'down' }
      ],
      DTT: [
        { name: '新增用户数 每月累计',    value: 249,    trend: 'down' },
        { name: '在线用户数 每月去重',    value: 344459, trend: 'down' },
        { name: '注册用户数 月末最后一天',value: 1848112,trend: 'down' },
        { name: '扣费金额 每月累计',      value: 180694, trend: 'down' },
        { name: '充值金额 每月累计',      value: 263016, trend: 'down' },
        { name: '扣费用户数 每月去重',    value: 340802, trend: 'down' },
        { name: '充值用户数 每月去重',    value: 112640, trend: 'down' },
        { name: '月扣费ARPPU',           value: 0.53,   trend: 'down' },
        { name: '月充值ARPPU',           value: 2.335,  trend: 'down' }
      ],
      OTT: [
        { name: '新增用户 本月累计',       value: 13426,  trend: 'up'  },
        { name: 'App日活 本月日均',       value: 46168,  trend: 'up'  },
        { name: 'App月活 本月日均',       value: 371110, trend: 'up'  },
        { name: '会员充值金额 本月累计',   value: 2365.15,trend: 'up'  },
        { name: 'DVB充值金额 本月累计',    value: 1782.63,trend: 'up'  },
        { name: '绑卡续费率 本月日均',     value: 31.74,  trend: 'up'  },
        { name: 'DSP广告收入 本月累计',   value: 9.78,   trend: 'up'  }
      ]
    };

    // 把 KPI 按照 “收视费 / 太阳能 / 终端+广告” 三大块分组
    function classifyMacro(bizId, metricName) {
      if (bizId === 'Solar') return 'Solar';
      if (/广告|DSP/.test(metricName)) return 'AdsDevices';
      if (/销量|终端|机顶盒|设备/.test(metricName) && bizId !== 'Solar') {
        return 'AdsDevices';
      }
      // 默认都算到收视费 Subscription
      return 'Subscription';
    }

    // 为散点计算扇区角度范围（和 63/30/7 对齐）
    var usedArcDeg = 280;  // 使用 280° 画三个扇区
    var startDeg = -usedArcDeg / 2;
    var cursorDeg = startDeg;
    macroDefs.forEach(function (m) {
      var sweep = usedArcDeg * (m.value / totalMacro);
      m.startDeg = cursorDeg;
      m.endDeg   = cursorDeg + sweep;
      cursorDeg += sweep;
    });

    // 辅助函数：根据 macroId 找扇区定义
    function getMacroDef(id) {
      return macroDefs.find(function (m) { return m.id === id; });
    }
    function getBizDef(id) {
      return businessDefs.find(function (b) { return b.id === id; });
    }

    // 生成星团点
    var clusterPoints = [];
    businessDefs.forEach(function (biz) {
      var metrics = kpiRaw[biz.id] || [];
      if (!metrics.length) return;

      var maxVal = metrics.reduce(function (m, x) {
        return Math.max(m, x.value);
      }, 0.0001);

      metrics.forEach(function (m) {
        var macroId = classifyMacro(biz.id, m.name);
        var macro = getMacroDef(macroId);
        if (!macro) return;

        var copies = 3 + Math.round((m.value / maxVal) * 3); // 3-6 个点
        var valueRatio = m.value / maxVal;

        for (var i = 0; i < copies; i++) {
          var angle =
            macro.startDeg + (macro.endDeg - macro.startDeg) * (0.1 + 0.8 * Math.random());
          var radius = 32 + 8 * Math.random() + 22 * (macroId === 'Subscription' ? 0 : macroId === 'Solar' ? 1 : 2);

          var baseSize = 5 + 8 * Math.sqrt(valueRatio);
          var size     = baseSize * (0.8 + Math.random() * 0.5);

          var trend = m.trend || 'flat';
          var alpha = 0.5 + Math.random() * 0.4;
          var color;
          if (trend === 'up') {
            color = 'rgba(74,222,128,' + alpha + ')';
          } else if (trend === 'down') {
            color = 'rgba(248,113,113,' + alpha + ')';
          } else {
            color = toneColor(biz.tone, alpha);
          }

          clusterPoints.push({
            value: [radius, angle],  // polar: [r, θ]
            bizId: biz.id,
            bizLabel: biz.label,
            macroId: macroId,
            macroLabel: macro.label,
            metric: m.name,
            rawValue: m.value,
            trend: trend,
            symbolSize: size,
            itemStyle: {
              color: color,
              opacity: 0.96
            }
          });
        }
      });
    });

    var option = {
      backgroundColor: 'transparent',
      tooltip: {
        trigger: 'item',
        formatter: function (params) {
          var d = params.data || {};
          if (!d.metric) return d.macroLabel || d.bizLabel || '';
          var trendText =
            d.trend === 'up'   ? '趋势：上升'
          : d.trend === 'down' ? '趋势：下降'
          : '趋势：相对平稳';
          return [
            d.macroLabel + ' · ' + d.bizLabel,
            d.metric,
            '当前值：' + d.rawValue,
            trendText
          ].join('<br/>');
        }
      },

      // 极坐标，用来放 KPI 星团
      polar: {
        center: ['50%', '62%'],
        radius: '78%'
      },
      angleAxis: {
        type: 'value',
        min: -180,
        max: 180,
        startAngle: 90,
        boundaryGap: false,
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { show: false }
      },
      radiusAxis: {
        type: 'value',
        min: 0,
        max: 120,
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: {
          show: true,
          lineStyle: { color: 'rgba(15,23,42,0.6)' }
        }
      },

      series: [
        // 中心 63 / 30 / 7 的环形图
        {
          type: 'pie',
          name: 'Revenue Split',
          radius: ['14%', '26%'],
          center: ['50%', '62%'],
          startAngle: 270,
          data: macroDefs.map(function (m) {
            return {
              value: m.value,
              name: m.label,
              itemStyle: { color: m.color }
            };
          }),
          label: {
            color: '#e5e7eb',
            formatter: '{b}'
          },
          labelLine: {
            length: 8,
            length2: 6
          },
          zlevel: 1
        },

        // 外圈 KPI 星团
        {
          type: 'scatter',
          coordinateSystem: 'polar',
          name: 'KPI Cluster',
          encode: { radius: 0, angle: 1 },
          data: clusterPoints,
          symbolSize: function (val, params) {
            return params.data.symbolSize || 6;
          },
          zlevel: 2
        }
      ]
    };

    chart.setOption(option);
    window.addEventListener('resize', function () {
      chart.resize();
    });
  </script>
</body>
</html>
